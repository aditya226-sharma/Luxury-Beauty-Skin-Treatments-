<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Gurubaksh Beauty</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .header { background: #d4af37; color: white; padding: 1rem; text-align: center; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .booking-card { background: white; margin: 1rem 0; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .booking-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .booking-id { font-weight: bold; color: #d4af37; }
        .status { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; }
        .status.pending { background: #fff3cd; color: #856404; }
        .status.confirmed { background: #d4edda; color: #155724; }
        .booking-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .detail-item { margin-bottom: 0.5rem; }
        .detail-label { font-weight: bold; color: #666; }
        .actions { margin-top: 1rem; }
        .btn { padding: 0.5rem 1rem; margin-right: 0.5rem; border: none; border-radius: 4px; cursor: pointer; }
        .btn-confirm { background: #28a745; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .no-bookings { text-align: center; color: #666; padding: 2rem; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Gurubaksh Beauty - Admin Panel</h1>
        <p>Manage Appointments</p>
    </div>
    
    <div class="container">
        <div id="bookings-container">
            <div class="no-bookings">Loading bookings...</div>
        </div>
    </div>

    <script>
        function loadBookings() {
            // Try to fetch from PHP, fallback to localStorage
        fetch('get-bookings.php')
                .then(response => {
                    if (!response.ok) throw new Error('Server not available');
                    return response.json();
                })
                .then(data => {
                    displayBookings(data);
                })
                .catch(error => {
                    console.log('Using localStorage fallback');
                    const localBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                    displayBookings(localBookings);
                });
    }
    
    function displayBookings(data) {
        const container = document.getElementById('bookings-container');
        
        if (data.length === 0) {
            container.innerHTML = '<div class="no-bookings">No bookings found.</div>';
            return;
        }
                    
        container.innerHTML = data.map(booking => `
                        <div class="booking-card">
                            <div class="booking-header">
                                <span class="booking-id">Token: ${booking.token_number || booking.id}</span>
                                <span class="status ${booking.status}">${booking.status.toUpperCase()}</span>
                            </div>
                            <div class="booking-details">
                                <div class="detail-item">
                                    <div class="detail-label">Token Number:</div>
                                    <div><strong>${booking.token_number || 'N/A'}</strong></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Name:</div>
                                    <div>${booking.name}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Phone:</div>
                                    <div>${booking.phone}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Email:</div>
                                    <div>${booking.email}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Service:</div>
                                    <div>${booking.service}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Date:</div>
                                    <div>${booking.date}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Time:</div>
                                    <div>${booking.time}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Message:</div>
                                    <div>${booking.message || 'No message'}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Created:</div>
                                    <div>${booking.created_at}</div>
                                </div>
                            </div>
                            <div class="actions">
                                ${booking.status === 'pending' ? `<button class="btn btn-confirm" onclick="updateStatus('${booking.id}', 'confirmed')">Confirm</button>` : ''}
                                <button class="btn btn-delete" onclick="deleteBooking('${booking.id}')">Delete</button>
                            </div>
                        </div>
        `).join('');
        }
        
        function updateStatus(id, status) {
            // Try PHP first, fallback to localStorage
            fetch('update-booking.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, status })
            })
            .then(response => {
                if (!response.ok) throw new Error('Server not available');
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    loadBookings();
                } else {
                    alert('Error updating booking');
                }
            })
            .catch(error => {
                // Fallback to localStorage
                let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                const bookingIndex = bookings.findIndex(b => b.token_number === id || b.id === id);
                if (bookingIndex !== -1) {
                    bookings[bookingIndex].status = status;
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    loadBookings();
                }
            });
        }
        
        function deleteBooking(id) {
            if (confirm('Are you sure you want to delete this booking?')) {
                // Try PHP first, fallback to localStorage
                fetch('delete-booking.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id })
                })
                .then(response => {
                    if (!response.ok) throw new Error('Server not available');
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        loadBookings();
                    } else {
                        alert('Error deleting booking');
                    }
                })
                .catch(error => {
                    // Fallback to localStorage
                    let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                    bookings = bookings.filter(b => b.token_number !== id && b.id !== id);
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    loadBookings();
                });
            }
        }
        
        // Load bookings on page load
        loadBookings();
        
        // Refresh every 30 seconds
        setInterval(loadBookings, 30000);
    </script>
</body>
</html>